# Module 3: Record Manager

## Complexity: ✅ Simple

---

## PRD Requirement

> **Build:** Content hashing, detect changes, only process what's new/modified
> **Learn:** Why naive ingestion duplicates, incremental updates

## Status: ✅ Complete

All tasks implemented and validated.

---

## Tasks

### 3.1 Content Hashing
- [x] `backend/app/services/hashing_service.py` — SHA-256 hash of file content bytes
- [x] `backend/app/models/document.py` — `content_hash` field on `DocumentResponse`

**Validation:** Hash is computed on upload and stored with the document record.

### 3.2 Duplicate Detection on Upload
- [x] `backend/app/api/routes/documents.py` — checks `get_document_by_hash(user_id, content_hash)` before processing
- [x] Returns existing document with `X-Duplicate: true` header if match found
- [x] `backend/app/services/supabase_service.py` — `get_document_by_hash()` query method

**Validation:** Re-uploading the same file returns the existing record without re-processing.

### 3.3 Database Schema
- [x] `supabase/migrations/003_record_manager.sql` — adds `content_hash TEXT` column + partial unique index `(user_id, content_hash) WHERE content_hash IS NOT NULL`

**Validation:** Unique index prevents same user from having duplicate content hashes.

### 3.4 Frontend Duplicate Feedback
- [x] `frontend/src/hooks/useDocuments.ts` — checks `X-Duplicate` response header, shows error message "This document has already been uploaded."

**Validation:** User sees clear feedback when uploading a duplicate.
